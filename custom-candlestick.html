<!DOCTYPE html>
<html>
<head>
    <title>Custom Candlestick - СИНИЙ и МОРКОВНЫЙ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1"></script>
</head>
<body>
    <div style="width: 800px; height: 400px;">
        <canvas id="chart"></canvas>
    </div>

    <script>
        // КАСТОМНЫЙ CANDLESTICK БЕЗ СТОРОННИХ БИБЛИОТЕК
        Chart.register({
            id: 'customCandlestick',
            beforeDatasetsDraw: function(chart) {
                const ctx = chart.ctx;
                const data = chart.data.datasets[0].data;
                const meta = chart.getDatasetMeta(0);
                
                data.forEach((point, index) => {
                    const { x, o, h, l, c } = point;
                    const element = meta.data[index];
                    const xPos = element.x;
                    const scale = chart.scales.y;
                    
                    const openY = scale.getPixelForValue(o);
                    const highY = scale.getPixelForValue(h);
                    const lowY = scale.getPixelForValue(l);
                    const closeY = scale.getPixelForValue(c);
                    
                    const candleWidth = 20;
                    const isUp = c > o;
                    
                    // СИНИЙ для роста, МОРКОВНЫЙ для падения
                    const color = isUp ? '#007bff' : '#ff8c42';
                    const borderColor = isUp ? '#0056b3' : '#cc6622';
                    
                    // Рисуем фитиль
                    ctx.strokeStyle = borderColor;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(xPos, highY);
                    ctx.lineTo(xPos, lowY);
                    ctx.stroke();
                    
                    // Рисуем тело свечи
                    ctx.fillStyle = color;
                    ctx.strokeStyle = borderColor;
                    ctx.lineWidth = 2;
                    
                    const bodyTop = Math.min(openY, closeY);
                    const bodyHeight = Math.abs(closeY - openY) || 2;
                    
                    ctx.fillRect(xPos - candleWidth/2, bodyTop, candleWidth, bodyHeight);
                    ctx.strokeRect(xPos - candleWidth/2, bodyTop, candleWidth, bodyHeight);
                });
                
                return false; // Не рисуем стандартные элементы
            }
        });

        const ctx = document.getElementById('chart').getContext('2d');
        
        // Тестовые данные
        const testData = [
            { x: '2024-01-01', o: 10, h: 15, l: 8, c: 14 },   // растущая (СИНЯЯ)
            { x: '2024-01-02', o: 14, h: 16, l: 11, c: 12 },  // падающая (МОРКОВНАЯ)
            { x: '2024-01-03', o: 12, h: 18, l: 10, c: 17 },  // растущая (СИНЯЯ)
            { x: '2024-01-04', o: 17, h: 19, l: 13, c: 15 }   // падающая (МОРКОВНАЯ)
        ];

        new Chart(ctx, {
            type: 'scatter',
            plugins: ['customCandlestick'],
            data: {
                datasets: [{
                    label: 'СИНИЕ и МОРКОВНЫЕ свечи',
                    data: testData,
                    showLine: false,
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            unit: 'day'
                        }
                    },
                    y: {
                        beginAtZero: false
                    }
                }
            }
        });
    </script>
</body>
</html> 